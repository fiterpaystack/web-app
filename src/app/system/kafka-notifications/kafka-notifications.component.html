<div class="container">
  <mat-card>
    <div class="container m-b-20 layout-row align-end">
      <button
        mat-raised-button
        color="primary"
        (click)="retryAll()"
        matTooltip="{{ 'tooltips.Retry all failed notifications' | translate }}"
      >
        <fa-icon icon="redo" class="m-r-10"></fa-icon>
        {{ 'labels.buttons.Retry All' | translate }}
      </button>
    </div>
    <mat-card-header>
      <mat-card-title>
        <fa-icon icon="bell" size="lg"></fa-icon>
        {{ 'labels.heading.Kafka Notifications' | translate }}
      </mat-card-title>
      <mat-card-subtitle>
        {{ 'labels.text.View Kafka notifications' | translate }}
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <div class="loading-container" *ngIf="isLoading">
        <mat-progress-bar mode="indeterminate"></mat-progress-bar>
      </div>

      <div class="table-container">
        <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8">
          <!-- Client Name Column -->
          <ng-container matColumnDef="clientName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{ 'labels.inputs.Client Name' | translate }}
            </th>
            <td mat-cell *matCellDef="let notification" [matTooltip]="notification.transactionDetails">
              {{ notification.clientName }}
            </td>
          </ng-container>

          <!-- Account Number Column -->
          <ng-container matColumnDef="accountNumber">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{ 'labels.inputs.Account Number' | translate }}
            </th>
            <td mat-cell *matCellDef="let notification" [matTooltip]="notification.transactionDetails">
              {{ notification.accountNumber }}
            </td>
          </ng-container>

          <!-- Account Product Name Column -->
          <ng-container matColumnDef="accountProductName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{ 'labels.inputs.Account Product' | translate }}
            </th>
            <td mat-cell *matCellDef="let notification" [matTooltip]="notification.transactionDetails">
              {{ notification.accountProductName }}
            </td>
          </ng-container>

          <!-- Event Type Column -->
          <ng-container matColumnDef="eventType">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{ 'labels.inputs.Event Type' | translate }}
            </th>
            <td mat-cell *matCellDef="let notification" [matTooltip]="notification.transactionDetails">
              <span class="event-type-badge">
                {{ getEventTypeDisplay(notification.eventType) }}
              </span>
            </td>
          </ng-container>

          <!-- PND Reason Column -->
          <ng-container matColumnDef="pndReason">
            <th mat-header-cell *matHeaderCellDef>
              {{ 'labels.inputs.Reason' | translate }}
            </th>
            <td mat-cell *matCellDef="let notification" [matTooltip]="notification.transactionDetails">
              {{ notification.pndReason }}
            </td>
          </ng-container>

          <!-- Status Column -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{ 'labels.inputs.Status' | translate }}
            </th>
            <td mat-cell *matCellDef="let notification" [matTooltip]="notification.transactionDetails">
              <span [ngClass]="getStatusColor(notification.status)">
                {{ notification.status }}
              </span>
            </td>
          </ng-container>

          <!-- Timestamp Column -->
          <ng-container matColumnDef="timestamp">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{ 'labels.inputs.Timestamp' | translate }}
            </th>
            <td mat-cell *matCellDef="let notification" [matTooltip]="notification.transactionDetails">
              <div class="timestamp-container">
                <div class="date">{{ formatTimestamp(notification.timestamp) | dateFormat }}</div>
                <div class="time">{{ formatTimestamp(notification.timestamp) | date: 'shortTime' }}</div>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns" class="select-row"></tr>
        </table>

        <mat-paginator
          *ngIf="!isLoading"
          [length]="dataSource?.records$ | async"
          [pageSize]="10"
          [pageSizeOptions]="[10, 25, 50, 100]"
          showFirstLastButtons
        ></mat-paginator>
      </div>
    </mat-card-content>
  </mat-card>
</div>
