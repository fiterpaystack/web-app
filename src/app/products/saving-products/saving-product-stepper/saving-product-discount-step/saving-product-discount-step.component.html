<form [formGroup]="savingProductDiscountForm">
  <div class="layout-row-wrap gap-2percent responsive-column align-start-center">
    <!-- Discount Engine Toggle -->
    <mat-checkbox
      class="flex-48 margin-v"
      labelPosition="before"
      matTooltip="{{ 'tooltips.Enable discount engine for this product' | translate }}"
      formControlName="enableDiscountEngine"
    >
      {{ 'labels.inputs.Enable Discount Engine' | translate }}
    </mat-checkbox>

    <span class="flex-48 hide-lt-md"></span>

    <!-- Discount Rules Section -->
    <div class="flex-98" *ngIf="isDiscountEngineEnabled">
      <!-- Add Rule Button -->
      <div class="flex-98 align-center margin-t">
        <button type="button" mat-raised-button color="primary" (click)="addDiscountRule()">
          {{ 'labels.buttons.Add Discount Rule' | translate }}
        </button>
      </div>

      <!-- Discount Rules List -->
      <div class="flex-98" *ngIf="discountRulesCount > 0">
        <div
          *ngFor="let rule of discountRules.controls; let i = index"
          [formGroupName]="i"
          class="discount-rule-card margin-t"
        >
          <!-- Rule Header -->
          <div class="rule-header layout-row align-center">
            <h4 class="flex-fill">{{ 'labels.inputs.Discount Rule' | translate }} {{ i + 1 }}</h4>
            <button
              type="button"
              mat-icon-button
              color="warn"
              matTooltip="{{ 'tooltips.Delete' | translate }}"
              matTooltipPosition="left"
              (click)="removeDiscountRule(i)"
            >
              <fa-icon icon="trash" size="lg"></fa-icon>
            </button>
          </div>

          <!-- Rule Details Form Fields -->
          <div class="layout-row-wrap gap-2px responsive-column">
            <mat-form-field class="flex-48">
              <mat-label>{{ 'labels.inputs.Rule Name' | translate }}</mat-label>
              <input
                matInput
                formControlName="name"
                matTooltip="{{ 'tooltips.Enter a unique name for this discount rule' | translate }}"
                required
              />
              <mat-error>
                {{ 'labels.inputs.Rule Name' | translate }} {{ 'labels.commons.is' | translate }}
                <strong>{{ 'labels.commons.required' | translate }}</strong>
              </mat-error>
            </mat-form-field>

            <mat-form-field class="flex-48">
              <mat-label>{{ 'labels.inputs.Discount Type' | translate }}</mat-label>
              <mat-select
                formControlName="ruleType"
                matTooltip="{{ 'tooltips.Select the type of discount to apply' | translate }}"
                required
              >
                <mat-option value="PERCENTAGE">{{ 'labels.inputs.Percentage' | translate }}</mat-option>
                <mat-option value="FLAT">{{ 'labels.inputs.Flat Amount' | translate }}</mat-option>
              </mat-select>
              <mat-error>
                {{ 'labels.inputs.Discount Type' | translate }} {{ 'labels.commons.is' | translate }}
                <strong>{{ 'labels.commons.required' | translate }}</strong>
              </mat-error>
            </mat-form-field>

            <mat-form-field class="flex-48">
              <mat-label>{{ 'labels.inputs.Rule Parameters' | translate }}</mat-label>
              <textarea
                matInput
                formControlName="ruleParametersJson"
                matTooltip="{{ 'tooltips.Enter rule parameters as JSON' | translate }}"
                rows="3"
              ></textarea>
            </mat-form-field>

            <mat-form-field class="flex-48">
              <mat-label>{{ 'labels.inputs.Priority' | translate }}</mat-label>
              <input
                type="number"
                matInput
                formControlName="priority"
                matTooltip="{{ 'tooltips.Rule priority for application order' | translate }}"
              />
            </mat-form-field>

            <mat-form-field class="flex-98">
              <mat-label>{{ 'labels.inputs.Description' | translate }}</mat-label>
              <textarea
                matInput
                formControlName="description"
                matTooltip="{{ 'tooltips.Optional description for this discount rule' | translate }}"
                rows="2"
              ></textarea>
            </mat-form-field>
          </div>
        </div>
      </div>

      <!-- No Rules Message -->
      <div class="flex-98" *ngIf="discountRulesCount === 0">
        <mat-card class="no-rules-card margin-t">
          <mat-card-content>
            <p>{{ 'labels.heading.No discount rules configured' | translate }}</p>
            <p>{{ 'labels.heading.Click Add Discount Rule to create your first rule' | translate }}</p>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </div>

  <!-- Navigation Buttons -->
  <div class="layout-row align-center gap-2percent margin-t responsive-column">
    <button mat-raised-button matStepperPrevious>
      <fa-icon icon="arrow-left" class="m-r-10"></fa-icon>
      {{ 'labels.buttons.Previous' | translate }}
    </button>
    <button mat-raised-button matStepperNext>
      {{ 'labels.buttons.Next' | translate }}
      <fa-icon icon="arrow-right" class="m-l-10"></fa-icon>
    </button>
  </div>
</form>
